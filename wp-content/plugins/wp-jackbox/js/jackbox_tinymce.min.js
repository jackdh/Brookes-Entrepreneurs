(function(e){function Z(){var a=e("#content_ifr");if(a.length)a.one("load.jackbox",ja);else $++,25>$&&setTimeout(Z,50)}function ja(){var a=e(this),a=a.contents();a.length&&(a=a.find("head"),a.length&&e("<style />").html("a.jackbox, a.jackbox:visited {background-color: #e5e5e5} .jackbox img {padding: 6px; margin: 0; background-color: #e5e5e5}").appendTo(a))}function ka(a,b,c){a=e(c);c=c.nodeName.toLowerCase();u=b;"a"===c||"img"===c?(b.setDisabled("jackbox",!1),"img"===c&&(a=a.closest("a"))):b.setDisabled("jackbox", !0);a.attr("class")?-1!==a.attr("class").search("jackbox")?b.setDisabled("jackbox_remove",!1):b.setDisabled("jackbox_remove",!0):b.setDisabled("jackbox_remove",!0)}function la(){A||(A=e(J).appendTo(e("body")),aa=window.send_to_editor,K=e(".jackbox-cover").click(L),f=e(K.find("form")).submit(ma),f.find("input[type=text], textarea"),ba=f.find("input[type=text], input[type=radio], textarea, select"),ca=e(window),j=f.find(".jb-extras"),M=f.find(".jb-category"),B=f.find("select[name=data-jbhover]"),da= K.find("h2")[0],p=f.find(".jb-multimedia"),titles=f.find("input[name=data-jbtitle]"),f.find("textarea[name=data-jbhtml]"),q=f.find(".jb-media-holder").hide(),C=f.find(".jb-thumb-holder").hide(),D=f.find(".jb-poster-holder").hide(),J=e(".jackbox-container").click(na),r=e(".jb-inline").children("input").change(oa),m=f.find("input[name=data-jbgroup]").keyup(pa),N=f.find("input[name=data-jbposter]").focusin(O).focusout(P),l=f.find("input[name=data-jbhref]").data("jbType",1).focusin(O).focusout(P),Q=f.find("input[name=data-jbthumbnail]").data("jbType", 2).focusin(O).focusout(P),ea=!!document.createElement("video").canPlayType,fa=-1===navigator.userAgent.toLowerCase().search("msie")&&!!document.createElement("video").canPlayType,i=[],e(".jackbox-addmedia").click(ga),e(".jackbox-close").click(L),e(".jackbox-small").keyup(qa),R=f.find(".jackbox-scale-no"),S=f.find(".jackbox-scale-yes"),E=f.find(".jackbox-scale-default"),T=f.find(".jackbox-autoplay-no"),U=f.find(".jackbox-autoplay-yes"),F=f.find(".jackbox-autoplay-default"),V=f.find(".jackbox-flash-no"), W=f.find(".jackbox-flash-yes"),G=f.find(".jackbox-flash-default"),X=f.find(".jackbox-hidden-yes"),H=f.find(".jackbox-hidden-no"),tinyMCE.execCommand("mceAddControl",!1,"jb-tiny-desc"),tinyMCE.execCommand("mceAddControl",!1,"jb-tiny-html"),v=tinyMCE.getInstanceById("jb-tiny-desc"),w=tinyMCE.getInstanceById("jb-tiny-html"),e("#jb-tiny-desc_ifr").css("background-color","#FFF"),e("#jb-tiny-desc_parent").css({display:"block",marginTop:7}).find(".mce_jackbox, .mce_jackbox_remove").remove(),s=e("#jb-tiny-html_ifr").css({backgroundColor:"#FFF", height:215}).hide(),x=e("#jb-tiny-html_parent").css({display:"block",paddingTop:7,clear:"both"}).hide(),x.find(".mce_jackbox, .mce_jackbox_remove").remove(),Array.prototype.indexOf||(Array.prototype.indexOf=ra));n=tinyMCE.getInstanceById("content");k=n.selection;u=n.controlManager;u.setDisabled("jackbox",!0);u.setDisabled("jackbox_remove",!0);var a=k.select(k.getNode()),b,c;h=e(a);h.is("img")&&(a=h.closest("a"),a.is("a")&&(h=a),c=!0);F.attr("checked","checked");E.attr("checked","checked");G.attr("checked", "checked");H.attr("checked","checked");B[0].selectedIndex=0;v.setContent("");e("#wp_editbtns").hide();if(h.is("a"))if(h.hasClass("jackbox"))for(a=ha.length;a--;){if(b=ha[a],h.attr(b))a:{c=b;b=h.attr(b);var d=void 0,g=void 0;if(-1!==c.search("data-jb")){g=c.split("data-jb")[1];switch(g){case "title":f.find("input[name="+c+"]").val(unescape(b));break a;case "description":v.setContent(unescape(b));break a;case "hover":d=f.find("select[name="+c+"]");break;case "html":r[0].checked=!0;r.trigger("change"); w.setContent(unescape(b));break a;default:d=f.find("input[name="+c+"]")}if(d.length)if("radio"!==d.attr("type"))switch(g){case "thumbnail":d.val(b);t(b,C);break;case "hover":if(c=b.match(sa))B[0].selectedIndex=B.find("option[value="+c+"]").index();break;case "poster":d.val(b);t(b,D);break;default:d.val(b)}else switch(g){case "scaleup":"no"===b?(S.removeAttr("checked"),E.removeAttr("checked"),R.attr("checked","checked")):"yes"===b&&(R.removeAttr("checked"),E.removeAttr("checked"),S.attr("checked", "checked"));break;case "autoplay":"no"===b?(U.removeAttr("checked"),F.removeAttr("checked"),T.attr("checked","checked")):"yes"===b&&(T.removeAttr("checked"),F.removeAttr("checked"),U.attr("checked","checked"));break;case "hiddenitem":"no"===b?(X.removeAttr("checked"),H.attr("checked","checked")):"yes"===b&&(H.removeAttr("checked"),X.attr("checked","checked"));break;case "flashhaspriority":"no"===b?(W.removeAttr("checked"),G.removeAttr("checked"),V.attr("checked","checked")):"yes"===b&&(V.removeAttr("checked"), G.removeAttr("checked"),W.attr("checked","checked"))}}else"href"===c&&(l.val(b),t(b,q))}}else{if(a=h.attr("href"))l.val(a),t(a,q);h.attr("title")&&titles.val(h.attr("title"))}else c?c&&h.attr("alt")&&titles.val(h.attr("alt")):(c=h.children("img"),c.length&&c.attr("alt")&&(titles.val(c.attr("alt")),h=c));c=n.getContent({format:"raw"});b=(d=c.match(/data-jbgroup="/g))?d.length:0;for(a=0;a<b;a++){g=c.indexOf('data-jbgroup="');for(d=g+15;'"'!==c.charAt(d);)d++;g=c.substring(g+14,d);-1===i.indexOf(g)&& (i[i.length]=g);c=c.substr(d,c.length)}if(i.length){b=i.length;d={type:"checkbox"};for(a=0;a<b;a++)c=i[a],d.name="jb-"+c,e("<input />").attr(d).change(ta).appendTo(j),e("<span />").text(" "+c).appendTo(j),e("<br />").appendTo(j);j.show();M.addClass("jb-noborder");m.val()?(a=i.indexOf(m.val()),-1!==a&&j.children("input[name=jb-"+i[a]+"]").attr("checked","checked")):(m.val(i[0]),j.children("input[name=jb-"+i[0]+"]").attr("checked","checked"))}A.stop(!0,!0).fadeIn(300);J.scrollTop(0);window.send_to_editor= ua}function ta(){if(this.checked)for(var a=j.children("input"),b=a.length,c;b--;)c=e(a[b]),c[0]!==this?c.removeAttr("checked"):(c.attr("checked","checked"),m.val(c.attr("name").split("jb-")[1]));else m.val("")}function pa(){var a=i.indexOf(this.value);-1===a?j.children("input").each(va):j.children("input[name=jb-"+i[a]+"]").attr("checked","checked")}function va(){e(this).removeAttr("checked")}function ma(a){a.preventDefault();if(window.confirm("Submit Changes?")){a=!0;y=r[0].checked;m.val()||(m.addClass("jb-error").one("focusin", Y),a=!1);if(y)w.getContent()||(s.addClass("jb-error").one("click",Y),a=!1);else{var b=l.val();if(!b||"#"===b)l.addClass("jb-error").one("focusin",Y),a=!1}a?(g=e("<a />"),h.attr("class")&&g.attr("class",h.attr("class")),g.removeClass("jackbox-hidden-item").addClass("jackbox"),h.is("a")?g.html(h.html()):g.append(h),ba.each(wa),k.setNode(g[0]),L()):da.scrollIntoView()}}function wa(){var a=e(this),b=a.attr("name"),c=a.attr("type"),d=a.val(),f=b.split("data-jb")[1];if("href"===f){if(y||!d)d="#";g.attr("href", d)}else{var h="description"===f;if(h||"html"===f){if(h)d=v.getContent();else if(y)d=w.getContent();else return;d&&g.attr(b,escape(d))}else if(d&&"checkbox"!==c)if("radio"!==c)"hover"===f&&"default"===d||("title"===f&&(d=escape(d)),g.attr(b,d));else if(a.attr("checked"))switch(a=a.attr("class").split("jackbox-").join(""),f){case "scaleup":"scale-yes"===a?g.attr(b,"yes"):"scale-no"===a?g.attr(b,"no"):g.removeAttr(b);break;case "autoplay":"autoplay-yes"===a?g.attr(b,"yes"):"autoplay-no"===a?g.attr(b, "no"):g.removeAttr(b);break;case "hiddenitem":"hidden-yes"===a&&(g.attr(b,"yes"),g.addClass("jackbox-hidden-item"));break;case "flashhaspriority":"flash-yes"===a?g.attr(b,"yes"):"flash-no"===a?g.attr(b,"no"):g.removeAttr(b)}}}function L(a){if(!a||window.confirm("Exit without Saving?"))A.stop(!0,!0).fadeOut(300),f.find("input[type=text], textarea").val(""),M.removeClass("jb-noborder"),i=[],y=!1,j.empty().hide(),q.empty().hide(),C.empty().hide(),D.empty().hide(),N.removeData("jborig"),r.removeAttr("checked"), Q.removeData("jborig"),m.removeClass("jb-error"),p.removeClass("jb-loading"),r.removeData("jbhasmedia"),l.removeData("jborig").removeClass("jb-error").show(),s.removeClass("jb-error").hide(),v.setContent(""),w.setContent(""),x.hide(),p.show(),window.send_to_editor=aa,ca.scrollTop(0)}function na(a){a.stopImmediatePropagation()}function ga(){var a=e(this).parent();a.hasClass("jb-multimedia")&&(a=a.parent());ia=a.find("input[type=text]").data("jbType");tb_show("","media-upload.php?type=image&amp;TB_iframe=true")} function ua(a){var b=e("img",a).attr("src"),c;b||(b=e(a).attr("href"));switch(ia){case 1:a=l;c=q;break;case 2:a=Q;c=C;break;default:a=N,c=D}a.val(b);t(b,c);tb_remove()}function O(){var a=e(this),b=a.val();b&&a.data("jborig",b)}function P(){var a=e(this),b=a.val();b!==a.data("jborig")&&t(b,e(this).parent().children(".jb-media"))}function t(a,b){var c=xa(a);b.empty().hide();if(c){var d;"vimeo"!==c?-1!==c.search("mp4")?fa?(d=e("<video />").attr("controls","controls").appendTo(b.show()),e("<source />").attr({type:"video/webm", src:c.split("mp4").join("webm")}).appendTo(d),e("<source />").attr({type:"video/mp4",src:c}).appendTo(d)):(d=e("<img />").one("load.jackbox",I).appendTo(b),d.attr("src",z+"../img/video.jpg")):-1!==c.search("mp3")?ea?(d=e("<audio />").attr("controls","controls").appendTo(b.show()),e("<source />").attr({type:"audio/ogg",src:c.split("mp3").join("ogg")}).appendTo(d),e("<source />").attr({type:"audio/mpeg",src:c}).appendTo(d)):(d=e("<img />").one("load.jackbox",I).appendTo(b),d.attr("src",z+"../img/audio.jpg")): (p.addClass("jb-loading"),d=e("<img />").one("load.jackbox",I).one("error.jackbox",ya).appendTo(b),d.attr("src",c)):(d=e("<img />").one("load.jackbox",I).appendTo(b),e.getJSON("http://vimeo.com/api/v2/video/"+a.split("https").join("http").split("http://vimeo.com/")[1]+".json?callback=?",{format:"json"},function(a){d.attr("src",a[0].thumbnail_small)}))}}function ya(){p.removeClass("jb-loading");e(this).unbind("load.jackbox")}function xa(a){if(-1!==a.search("youtube"))return"http://img.youtube.com/vi/"+ a.split("http://www.youtube.com/watch?v=")[1]+"/1.jpg";if(-1!==a.search("vimeo"))return"vimeo";var b=a.split(".");if(!b.length)return null;b=b[b.length-1];return"jpg"===b||"png"===b||"gif"===b||"mp4"===b||"mp3"===b?a:null}function I(){var a=e(this).unbind("error.jackbox");p.removeClass("jb-loading");a.parent().show();var b=this.width||a.width(),c=this.height||a.height(),d=75<c?75/c:1;223<b*d&&(d=223/b);a.attr({width:b*d,height:c*d}).click(ga)}function oa(){var a=e(this);this.checked?(""!==q.html()&& (a.data("jbhasmedia",!0),q.hide()),p.hide(),l.hide(),x.show(),s.show()):(s.hide(),x.hide(),p.show(),l.show(),a.data("jbhasmedia")&&(a.removeData("jbhasmedia"),q.show()));l.removeClass("jb-error");s.removeClass("jb-error")}function ra(a){for(var b=this.length;b--;)if(this[b]===a)return b;return-1}function qa(){this.value=this.value.replace(za,"")}function Y(){e(this).removeClass("jb-error")}function Aa(){k=e(n.selection.getNode());k.is("img")&&(k=k.parent());k.removeClass("jackbox jackbox-hidden-item"); u.setDisabled("jackbox_remove",!0);for(var a=k[0].attributes,b=a.length,c;b--;)c=a[b].name,-1!==c.search("data-jb")&&k.removeAttr(c)}var g,ca,i,h,aa,z,f,B,K,A,l,p,j,n,ba,N,T,da,r,m,ia,V,R,U,F,u,ea,fa,M,S,E,W,G,x,w,v,H,X,y,k,Q,s,q,C,D,$=0,za=/[^0-9\.|#|-]/g,sa=/none|black-magnify|black-play|black-document|white-magnify|white-play|white-document|blur-magnify|blur-play|blur-document/g,ha="href data-jbgroup data-jbhref data-jbtitle data-jbdescription data-jbwidth data-jbheight data-jbthumbnail data-jbthumbtooltip data-jbhover data-jbscaleup data-jbautoplay data-jbflashhaspriority data-jbposter data-jbaudiotitle data-jbhiddenitem data-jbhtml".split(" "), J='<div class="jackbox-modal"><div class="jackbox-cover"><div class="jackbox-container"><input class="jackbox-close" type="submit" value="x" /><div class="jackbox-content"><h2>'+jackboxTranslate.jb_1+'</h2><hr /><form class="jackbox-form" method="post" enctype="text/plain"><h3>'+jackboxTranslate.jb_2+'</h3><p class="jb-category">'+jackboxTranslate.jb_3+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_4+'">?</span><br /><input class="jackbox-medium" name="data-jbgroup" type="text" /></p><p class="jb-extras"></p><hr /><p><span class="jb-multimedia">'+ jackboxTranslate.jb_5+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_6+'">?</span></span><span class="jb-inline">'+jackboxTranslate.jb_7+'<span class="jackbox-question jb-q1" data-title="'+jackboxTranslate.jb_8+'">?</span><input type="checkbox" name="data-jbcontent" /></span><input name="data-jbhref" type="text" /><textarea id="jb-tiny-html" name="data-jbhtml"></textarea><span class="jb-media jb-media-holder"></span></p><hr /><h3>'+ jackboxTranslate.jb_9+"</h3><p>"+jackboxTranslate.jb_10+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_11+'">?</span><br /><input class="jackbox-medium" name="data-jbtitle" type="text" /></p><hr /><p>'+jackboxTranslate.jb_12+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_13+'">?</span><br /><textarea id="jb-tiny-desc" name="data-jbdescription"></textarea></p><hr /><div><p>'+jackboxTranslate.jb_14+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_15+ '">?</span><br /><input class="jackbox-small" name="data-jbwidth" type="text" /></p><p>'+jackboxTranslate.jb_16+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_17+'">?</span><br /><input class="jackbox-small" name="data-jbheight" type="text" /></p></div><hr /><p>'+jackboxTranslate.jb_18+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_19+'">?</span><br /><span class="jackbox-box"><input class="jackbox-scale-yes" name="data-jbscaleup" type="radio" value="true" /> '+ jackboxTranslate.jb_yes+' <input class="jackbox-scale-no" name="data-jbscaleup" type="radio" value="false" /> '+jackboxTranslate.jb_no+' <input class="jackbox-scale-default" name="data-jbscaleup" type="radio" value="default" /> '+jackboxTranslate.jb_default+"</span></p><hr /><p>"+jackboxTranslate.jb_20+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_21+'">?</span><br /><select name="data-jbhover"><option value="default" selected>'+jackboxTranslate.jb_default+'</option><option value="none">'+ jackboxTranslate.jb_22+'</option><option value="black-magnify">'+jackboxTranslate.jb_23+'</option><option value="black-play">'+jackboxTranslate.jb_24+'</option><option value="black-document">'+jackboxTranslate.jb_25+'</option><option value="white-magnify">'+jackboxTranslate.jb_26+'</option><option value="white-play">'+jackboxTranslate.jb_27+'</option><option value="white-document">'+jackboxTranslate.jb_28+'</option><option value="blur-magnify">'+jackboxTranslate.jb_29+'</option><option value="blur-play">'+ jackboxTranslate.jb_30+'</option><option value="blur-document">'+jackboxTranslate.jb_31+"</option></select></p><hr /><p>"+jackboxTranslate.jb_32+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_33+'">?</span><br /><input name="data-jbthumbnail" type="text" /><br /><span class="jb-media jb-thumb-holder"></span></p><hr /><p>'+jackboxTranslate.jb_34+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_35+ '">?</span><br /><input class="jackbox-medium" name="data-jbthumbtooltip" type="text" /></p><hr /><div><p>'+jackboxTranslate.jb_36+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_37+'">?</span><br /><span class="jackbox-box"><input class="jackbox-autoplay-yes" name="data-jbautoplay" type="radio" value="true" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-autoplay-no" name="data-jbautoplay" type="radio" value="false" /> '+jackboxTranslate.jb_no+' <input class="jackbox-autoplay-default" name="data-jbautoplay" type="radio" value="default" /> '+ jackboxTranslate.jb_default+"</span></p><p>"+jackboxTranslate.jb_38+' <span class="jackbox-question jb-q1" data-title="'+jackboxTranslate.jb_39+'">?</span><br /><span class="jackbox-box"><input class="jackbox-flash-yes" name="data-jbflashhaspriority" type="radio" value="false" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-flash-no" name="data-jbflashhaspriority" type="radio" value="true" /> '+jackboxTranslate.jb_no+' <input class="jackbox-flash-default" name="data-jbflashhaspriority" type="radio" value="default" /> '+ jackboxTranslate.jb_default+"</p></div><hr /><p>"+jackboxTranslate.jb_40+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_41+'">?</span><br /><input name="data-jbposter" type="text" /><br /><span class="jb-media jb-poster-holder"></span></p><hr /><p>'+jackboxTranslate.jb_42+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_43+'">?</span><br /><input class="jackbox-medium" name="data-jbaudiotitle" type="text" /></p><hr /><p>'+ jackboxTranslate.jb_44+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_45+'">?</span><br /><span class="jackbox-box"><input class="jackbox-hidden-yes" name="data-jbhiddenitem" type="radio" value="false" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-hidden-no" name="data-jbhiddenitem" type="radio" value="true" /> '+jackboxTranslate.jb_no+'</span></p><hr /><p class="submit_jb"><input type="submit" class="button-primary" value="'+jackboxTranslate.jb_46+'" /></p></form></div></div></div></div>'; tinymce.create("tinymce.plugins.jackbox",{init:function(a,b){n=a;z=b+"/";n.addButton("jackbox",{title:"Add/Edit JackBox",image:z+"../img/jackbox.png",onclick:la});n.addButton("jackbox_remove",{title:"Remove JackBox",image:z+"../img/jackbox_remove.png",onclick:Aa});Z();n.onNodeChange.add(ka)}});tinymce.PluginManager.add("jackbox",tinymce.plugins.jackbox)})(jQuery);